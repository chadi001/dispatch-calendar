<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dispatch Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>body{font-family:Segoe UI,Arial;margin:0;background:#f4f7fb}.w{max-width:1100px;margin:0 auto;padding:12px}.h{background:#0f172a;color:#fff;padding:12px;border-radius:12px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px}.k{display:grid;grid-template-columns:repeat(6,minmax(120px,1fr));gap:8px;margin-top:10px}.c{background:#fff;border:1px solid #dbe2ea;border-radius:12px;padding:10px}.l{font-size:12px;color:#64748b;font-weight:700}.v{font-size:28px;font-weight:900}button,input{height:34px;border:1px solid #d1d5db;border-radius:10px;padding:0 10px}a{color:#fff}</style>
</head><body><div class="w"><div class="h"><div><b>Dispatch KPI Dashboard</b><div id="who" style="font-size:12px;color:#cbd5e1">Not signed in</div></div><div><a href="index.html">Back to calendar</a></div></div><div id="login" class="c" style="margin-top:10px"><input id="email" type="email" placeholder="email"> <input id="pass" type="password" placeholder="password"> <button id="signin">Sign in</button></div><div id="dash" style="display:none"><div class="k"><div class="c"><div class="l">Total</div><div id="t" class="v">0</div></div><div class="c"><div class="l">Scheduled</div><div id="s" class="v">0</div></div><div class="c"><div class="l">In progress</div><div id="p" class="v">0</div></div><div class="c"><div class="l">Completed</div><div id="d" class="v">0</div></div><div class="c"><div class="l">Cancelled</div><div id="x" class="v">0</div></div><div class="c"><div class="l">Overdue</div><div id="o" class="v">0</div></div></div></div></div>
<script>
const U='https://mycgdissxzsizoywcwps.supabase.co',K='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15Y2dkaXNzeHpzaXpveXdjd3BzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzkyNDEsImV4cCI6MjA4NTc1NTI0MX0.1-3qDwNwFeqlHjn-jCACOtV5U2yhgEsQ1yUM-m2TKZg';
const sb=supabase.createClient(U,K,{auth:{persistSession:true,autoRefreshToken:true,detectSessionInUrl:true,storageKey:'dispatch-auth-v1'}}),$=id=>document.getElementById(id);
function set(id,v){$(id).textContent=String(v)}
async function load(){const {data,error}=await sb.from('jobs').select('job_date,status,cancelled'); if(error) return alert(error.message); const t=(data||[]); let s=0,p=0,d=0,x=0,o=0,now=new Date().toISOString().slice(0,10); t.forEach(r=>{const st=String(r.status||(r.cancelled?'cancelled':'scheduled')).toLowerCase(); if(st==='scheduled')s++; else if(st==='in_progress')p++; else if(st==='completed')d++; else if(st==='cancelled')x++; if(st!=='completed'&&st!=='cancelled'&&String(r.job_date||'')<now)o++;}); set('t',t.length);set('s',s);set('p',p);set('d',d);set('x',x);set('o',o);} 
async function boot(){const {data:{user}}=await sb.auth.getUser(); if(!user){$('login').style.display='block';return;} $('login').style.display='none';$('dash').style.display='block'; $('who').textContent='Signed in: '+(user.email||''); await load();}
$('signin').onclick=async()=>{const {error}=await sb.auth.signInWithPassword({email:$('email').value.trim(),password:$('pass').value}); if(error) return alert(error.message); location.reload();};
boot();
</script></body></html>
